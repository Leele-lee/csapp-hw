# 11.12

## BASIC CONCPET

Extend TINY so that it servesdynamiccontentrequested bythe HTTP POST method. Checkyourworkusing yourfavorite Web browser.

> `POST` method:
The POST method is used by web clients (like browsers) to send data to the server in the body of the HTTP request. And GET method is through URI in request line.

## THREAD

To handle POST method, we should:

1. **check the HTTP request method**: Modify the TINY server to check if the HTTP request is a POST request.

    ```c
        if ((strcasecmp(method, "GET") != 0) && (strcasecmp (method, "POST") != 0)) { // line:netp:doit:beginrequesterr
            clienterror(fd, method, "501", "Not Implemented",
                    "Tiny does not implement this method");
            return;
        } // line:netp:doit:endrequesterr

    ```

2. **Read the post data**: For POST requests, the data will be sent in the body of the request, not in the URL like GET requests. You need to read this data. In GET method we using `read_requesthdrs` function to direct ignore request header, now we need modify `read_requesthdrs` so we can read the data length in request header.

    ```c
    int read_requesthdrs(rio_t *rp, char *method)
    {
        char buf[MAXLINE];
        int len;

        do
        {
            Rio_readlineb(rp, buf, MAXLINE);
            printf("%s", buf);
            if (strcasecmp(method, "POST") == 0 && strncasecmp(buf, "Content-Length:", 15) == 0)
            {
                sscanf(buf, "Content-Length: %d", &len);
            }
        } while (strcmp(buf, "\r\n"));
        return len;
    }
    ```

3. **Process the POST data**: The data can be passed to a CGI script or handled directly by the server (e.g., to perform some operation like saving data, calculating something, etc.). In this tiny adder server, we dealt it in `doit` function instead of `server_dynamic`. First we put the paraments in request header into buf, then if POST method we pass buf instead of cgiargs into `serve_dynamic`.

    ```c
        bodylen = read_requesthdrs(&rio, method); // line:netp:doit:readrequesthdrs
        Rio_readnb(&rio, buf, bodylen);
        if (is_static)
        { /* Serve static content */
            ...
        }
        else
        { /* Serve dynamic content */
            ...
            if (strcasecmp(method, "POST") == 0)
            {
               serve_dynamic(fd, filename, buf);
            }
            else
            {
               serve_dynamic(fd, filename, cgiargs); // line:netp:doit:servedynamic
            }
        }
    ```

4. **change html to deal with POST methos instead of GET method**

   ```c
    <!DOCTYPE html>
    <html>
    <head>
        <title>Adder Form</title>
    </head>
    <body> 
        <h1>Simple Adder Form</h1>
        <form action="/cgi-bin/adder" method="POST">
            <label for="num1">First number:</label>
            <input type="text" name="num1" id="num1"><br><br>

            <label for="num2">Second number:</label>
            <input type="text" name="num2" id="num2"><br><br>

            <input type="submit" value="Add">
        </form>
    </body>
    </html>
   ```